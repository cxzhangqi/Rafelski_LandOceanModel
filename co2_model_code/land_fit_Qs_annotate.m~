% Things to check: end year chosen? line 12
% beta variables defined correctly? lines 22-36
% correct model chosen? lines 58-69
% correct time period for yhat? line 64

function yhat = land_fit_Qs_annotate(beta,X)

% Initial conditions - set according to Joos et al

ts = 12;
start_year = 1850;
end_year = 2009+(7/12);

% Get parameters

[dtdelpCO2a,dpCO2a,year,dt,CO2a] = MLOinterpolate_increment2(ts,start_year,end_year);

[landusemo,ff1,fas,Aoc,extratrop_landmo] = getsourcesink_scale3;

%% To make temperature-independent: set Q1 and Q2 to 1

%% CO2 fertilization model
epsilon = beta(1);
Q1 = beta(2);
Q2 = 1;%beta(2);
 
% epsilon = 0;
% gamma = beta(1);
% Q1 = beta(2);
% Q2 = 1;%beta(3);
% % C1 = beta(3);

% epsilon = beta(1);
% gamma = beta(2);
% Q1 = beta(3);
% Q2 = beta(4);

year2 = year';

  
[C1dt,C2dt,delCdt,delC1,delC2] = bioboxtwo_sub10_annotate(epsilon,Q1,Q2,ts,year2,dpCO2a,X); 


%% Nitrogen fertilization

%[C1dt,C2dt,delCdt,delC1,delC2] = bioboxtwo_subN(epsilon,Q1,Q2,gamma,ff1(601:end,:),ts,year2,dpCO2a,X);
   % calculate land uptake, temperature input doesn't matter because don't use it
 

%[C1dt,C2dt,delCdt,delC1,delC2] = bioboxtwo_Nsize(epsilon,Q1,Q2,gamma,C1,ff1(601:end,:),ts,year2,dpCO2a,X);
   
delCdt(:,2) = -delCdt(:,2);
%delCdt(601:end,:)   

   [delC10] = l_boxcar(delCdt,10,12,1,length(delCdt),1,2);
%     [delC10a] = l_boxcar(delCdt,10,12,1225,length(delCdt),1,2);
%     delC10(1:1284,:) = delCdt(1:1284,:);
%     delC10(1285:length(delC10a),:) = delC10a(1285:end,:);

%% This is the term that is compared to the residual flux in nlinfit. 
%% Change the index numbers here and in nonlin_land_Qs_annotate (e.g. line
%% 158) to fit to a different time period

yhat = delC10(601:end,2);
